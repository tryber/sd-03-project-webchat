<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO - webchat</title>
    <style>
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
    </script>
  </head>
  <body>
    <form>
      <input type="text" id="nickname-box" data-testid="nickname-box"/>
      <button id="nickname-save" data-testid="nickname-save" type="button">SAVE</button>
    </form>
    <div id="messagens-history"></div>
    <form>
      <input type="text" id="message-box" data-testid="message-box"/>
      <button id="send-button" data-testid="send-button" type="button">SEND</button>
    </form>
  </body>
  <script>
    const socket = io('http://localhost:3000')
    let sendMessage = document.getElementById('send-button');
    let changeNick = document.getElementById('nickname-save');

    const randomUserName = () => {
      const randomNumber = parseInt(Math.random() * 100000 );
      return `User${randomNumber}`;
    };
    
    let username = randomUserName();

    socket.on('message', (data) => {
      const p = document.createElement('p');
      p.setAttribute("data-testid", "message")
      p.textContent = data;
      document.getElementById('messagens-history').appendChild(p);
    });

    sendMessage.addEventListener('click',function() {
      const message = document.getElementById('message-box');
      socket.emit("message", { chatMessage: message.value , nickname: username });      
      message.value = '';
    });

    changeNick.addEventListener('click',function() {
      let newNick = document.getElementById("nickname-box");
      username = newNick.value;
      newNick.value = '';
    });
   </script>
</html>