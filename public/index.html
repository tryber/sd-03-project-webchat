<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mensagens Sem Nexo</title>

  <!-- Carrega o socket.io -->
  <script src="http://localhost:4555/socket.io/socket.io.js"></script>

  <!-- Carrega o moment.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment-with-locales.min.js"></script>

</head>

<body>

  <section>
    <form id="webchat">
      <label for="user">Nome de usuario:</label>
      <input type="text" name="user" id="user" placeholder="username"><br>

    <div id="messageWrapper">
      <p>Bem vindo ao MSN</p>
    </div>
      <input type="text" name="message" id="message" placeholder="message"><br>
      <button type="submit">Send</button>
    </form>
  </section>

  <script type="text/javascript">
    const socket = io('http://localhost:4555')

    socket.on('messageHistory', (history) => history.map((message) => renderMessage(message)));

    const renderMessage = (messageObject) => {
      const { user, message, sentTime } = messageObject;
      const p = document.createElement('p')
      p.textContent = `${user}: ${message} enviado as: ${sentTime}`;
      document.getElementById('messageWrapper').appendChild(p)
    }

    const webchat = document.getElementById('webchat');
    webchat.onsubmit = (event) => {
      event.preventDefault();

      const user = document.getElementById('user').value;
      const message = document.getElementById('message').value;
      const sentTime = moment().format('D-M-YYYY, HH:mm:ss');

      const messageObject = { user, message, sentTime };

      renderMessage(messageObject);

      socket.emit('message', messageObject);
    }

    socket.on('messageReceived', (messageObject) => renderMessage(messageObject));

    
  </script>
</body>

</html>