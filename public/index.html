<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebChat</title>
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
  </head>
  <body>
    <ul id="messagens"></ul>
    <form action="">
      <input data-testid="message-box" type="text" id="input" name="message-input" />
      <button data-testid="send-button" type="submit" id="submit">Enviar</button>


      <input data-testid="nickname-box" id="newNick" type="text" autocomplete="off" />
      <button data-testid="nickname-save" type="submit" id="submitNick">Change Name</button>

    </form>
    <script>
      window.onload = () => {
        const submit = document.getElementById("mensagemInput");
        const newNick = document.getElementById('newNick');
        const submitNewNick = document.getElementById('submitNick');
        const socket = io();

        socket.on("message", (data) => {
          const li = document.createElement("li");
          li.id = "list-of-messages";
          li.setAttribute("data-testid", "message");
          li.textContent = data;
          document.getElementById("messagens").appendChild(li);
        });

        const getRandomName = () => `User ${Math.ceil(Math.random() * 100)}`;

        submit.addEventListener("click", (e) => {
          e.preventDefault();
          const mensagem = document.getElementById("submit");
          socket.emit("message", {
            chatMessage: mensagem.value,
            nickname: getRandomName,
          });
          mensagem.value = "";
        });


        submitNewNick.addEventListener('click', (e) => {
          e.preventDefault();

          socket.emit('changeName', ({ newNickName: newNick.value }));
          newNick.value = '';
        })
      };
    </script>
  </body>
</html>
