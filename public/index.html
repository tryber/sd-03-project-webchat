<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zap Efron</title>
    <link rel="stylesheet" type="text/css" href="./style.css" media="screen" />
    <script src="/socket.io/socket.io.js"></script>
    <script defer>
      const socket = io('http://localhost:3000');

      const sendButton = document.getElementById('send-button');
      const messageBox = document.getElementById('message-box');
      // const nicknameSave = document.getElementById('nickname-save');
      // const nicknameBox = document.getElementById('nickname-box');
      const userNickname = document.getElementById('nickname');

      const joinedChat = ({ nickname }) => {
        const li = document.createElement('li');

        userNickname.textContent = nickname;

        li.textContent = `${nickname} entrou no chat`;
        li.classList = 'joined message';

        document.getElementById('ul-messages').appendChild(li);
      };

      // const sendMessage = (event) => {
      //   event.preventDefault();

      //   const message = messageBox.value;
      //   const nickname = userNickname.value;
      //   const date = Date.now();

      //   socket.emit('message', { message, nickname, date });
      // };

      const receivedMessage = ({ message }) => {
        console.log('oii');
        const li = document.createElement('li');

        li.textContent = message;
        li.setAttribute('data-testid', 'message');
        li.classList = 'message';

        document.getElementById('ul-messages').appendChild(li);
      };

      sendButton.addEventListener('click', (e) => {
        e.preventDefault();

        const message = messageBox.value;
        const nickname = userNickname.innerText;
        const date = Date.now();

        socket.emit('message', { message, nickname, date });
      });

      socket.on('connect', () => {
        console.log('connect');
      });

      socket.on('joined', (data) => joinedChat(data));

      socket.on('message', (data) => receivedMessage(data));
    </script>
  </head>
  <body>
    <div id="app-content">
      <div id="header">
        <h1>Zap Efron</h1>
      </div>
      <div id="user-content">
        <div id="user-photo"></div>
        <div id="nickname"></div>
        <form id="form-nickname">
          <input
            id="nickname-box"
            placeholder="Me chame de..."
            data-testid="nickname-box"
          />
          <button id="nickname-save" data-testid="nickname-save">Salvar</button>
        </form>
      </div>
      <div id="chat-content">
        <div>
          <ul id="ul-messages"></ul>
        </div>
        <div>
          <form id="form-message">
            <input
              id="message-box"
              placeholder="Digite uma mensagem..."
              data-testid="message-box"
            />
            <button id="send-button" data-testid="send-button">Enviar</button>
          </form>
        </div>
      </div>
    </div>
  </body>
</html>
