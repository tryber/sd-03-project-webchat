<!DOCTYPE html>
<html>

<head>
  <title>Web Chat</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src='http://localhost:3000/socket.io/socket.io.js'></script>
</head>

<body>
  <form id="chat">
    <input type=text data-testid="nickname-box" name="usuario" placeholder="Digite seu nome" />
    <button type="button" data-testid="nickname-save">Salvar nome</button>
    <input data-testid="message-box" id="idMessage" name="mensagens" placeholder="Digite sua mensagem" />
    <button type="submit" data-testid="send-button" id="send-buttons">Enviar</button>
    <div id="message" ></div>
  </form>

  <script>
    let socket = io('http://localhost:3000');

    function renderizarMensagem(nickname, mensagens) {
      $('#message').append('<div data-testid="message" classe="message">'+nickname+': '+mensagens+'<div/>');
    };

    socket.on('msgRecebida', function(ObjMessage){
      renderizarMensagem(ObjMessage.nickname,ObjMessage.mensagens);
    });

    $('#chat').submit(function (e) {
      e.preventDefault();
      let nickname = $('input[name=usuario]').val();
      let mensagens = $('input[name=mensagens]').val();

      if (nickname.length && mensagens.length) {
        const ObjMessage = {
          nickname: nickname,
          mensagens: mensagens,
        };

        renderizarMensagem(nickname,mensagens);
        socket.emit('SendMessage', ObjMessage);
      };
      const mensagensId = document.getElementById('idMessage');
      mensagensId.value = '';
    });
  </script>
</body>

</html>