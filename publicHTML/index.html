<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Socket.io - Client Demo</title>

  <!-- Carrega o socket.io -->
  <script src="http://localhost:4555/socket.io/socket.io.js"></script>

  <!-- Configura interação com o servidor -->
  
</head>
<body>
  <div>
    <span id="nickname"></span><br>
    <input type="text" id="nickname-box" />
    <button type="button" id="nickname-save">Salvar Nickname</button>
    <fieldset>
      <span>Mensagens</span>
      <ul id="allMessages"></ul>
    </fieldset>
    <input type="text" id="message-box" />
    <button type="submit" id="send-button">Enviar</button>
    <fieldset>
      <span>Online</span>
      <ul id="allUsers"></ul>
    </fieldset>
  </div>
  <script>
    const socket = io('http://localhost:4555');
    const textInput = document.getElementById('message-box');
    const sendButton = document.getElementById('send-button');
    const nickname = document.getElementById('nickname');
    const nicknameSaveBtn = document.getElementById('nickname-save');
    const nicknameTextBox = document.getElementById('nickname-box');
    
    sendButton.addEventListener('click', (e) => {
      e.preventDefault();
      const messageObj = {
        chatMessage: textInput.value,
        nickname: nickname.textContent,
      }
      socket.emit('message', messageObj);
      textInput.value = '';
    });
    
    socket.on('history', (messages) => {
      document.getElementById('allMessages').innerHTML = '';
      return messages.forEach(({ nickname, chatMessage }) => {
        const li = document.createElement('li');
        li.textContent = `${nickname}: ${chatMessage}`;
        document.getElementById('allMessages').appendChild(li);
      });
    });

    socket.on('newText', ({ nickname, chatMessage }) => {
      const li = document.createElement('li');
      li.textContent = `${nickname}: ${chatMessage}`;
      document.getElementById('allMessages').appendChild(li)
    });

    nickname.textContent = `Guest ${ Math.floor(((Math.random() * 1000) + 1)) }`;
    socket.emit('nickname', nickname.textContent);

    nicknameSaveBtn.addEventListener('click', () => {
      nickname.textContent = nicknameTextBox.value;
      socket.emit('nickname', nickname.textContent);
      nicknameTextBox.value = '';
    });

    socket.on('onlines', (data) => {
      document.getElementById('allUsers').innerHTML = '';
      return data.forEach(({ nickname }) => {
        const li = document.createElement('li');
        li.textContent = nickname;
        document.getElementById('allUsers').appendChild(li)
      })
    });

  </script>
</body>
</html>
